<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="js/jquery2.0.0.js"></script>
	<script src="js/p5.js"></script>
	<script src="js/p5.dom.js"></script>
	<script src="js/p5.sound.js"></script>	
	<script src="js/socket.io.js"></script>
	<style>
	img{
		width: 320px;
		height: 240px;
		margin-right: 5px;
		margin-left: 5px;
		border: 2px solid gray;
	}	
	</style>
</head>
<html>
<body>
	<script type="text/javascript">
	var c;
	var video;
	var socket = io.connect('https://'+document.domain+":"+location.port);
	var personalId = null;
	var containsAllids = [];
	
	socket.on('myId', function(myId){
		personalId = myId;				
	});

	socket.on('remove-user', function(data){					
      $('#'+data.detail).remove();
      containsAllids.splice(indexOf(data.detail),1);
    });

	socket.on('connectIds', function(allIds){		
		containsAllids = allIds;		
		$('img').remove();
		$.each(allIds, function(index, value){
			if(value != personalId){				
				$('body').append('<img id='+value+'>');
			}			
		});		
	});

	socket.on('updateAllUser', function(data){			
		var blob;
		for(var i=0; i<containsAllids.length; i++){
			if(data.streamId == containsAllids[i]){
				$('#'+data.streamId).attr('src', data.capture);	
			}
		}
		//$('#'+data.theIds).attr('src', data.theCaps);		
		/* var b= new Promise(function(resolve,reject){
			resolve(data);
		});
		b.then(function(result){
			$('#'+result.theIds).attr('src', result.theCaps);
		});		*/	
	});	
	
	function setup(){						
		c = createCanvas(320,240);				
		video = createCapture(VIDEO);		
		video.size(320,240);
		video.hide();
	}
	function draw(){
		image(video, 0, 0, 320, 240);
		if(frameRate() > 55 && personalId != null){
			socket.emit('updateUser', {streamId:personalId, capture:c.canvas.toDataURL()});
		}
	}
	</script>	
</body>	
</html>

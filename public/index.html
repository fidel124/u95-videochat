<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="js/jquery2.0.0.js"></script>
	<script src="js/p5.js"></script>
	<script src="js/p5.dom.js"></script>
	<script src="js/p5.sound.js"></script>	
	<script src="js/socket.io.js"></script>
	<style>
	img{
		width: 320px;
		height: 240px;
		margin: 5px;
		border: 5px solid red;
	}
	</style>
</head>
<html>
<body>
	<script>
	var c;
	var video;
	var socket = io.connect('http://'+document.domain+":"+location.port);
	var id = null;

	socket.on('myId', function(myId){
		id = myId;
		console.log(id);
	});

	socket.on('remove-user', function(data){		
      $('#'+data.detail).remove();
    });

	socket.on('friends', function(users){  
		$('img').remove();
		$.each(users, function(index, val){
			if(val != id){				
				$('body').append('<img id='+val+'>');
			}
		});
	});

	socket.on('updateAllUser', function(data){
		console.log(data);
		var d1 = new Promise(function(resolve, reject){
			resolve(data);
		});
		d1.then(function(data){
			$('#'+data.id).attr('src',data.capture);
		});				
	});	

	function setup(){
		c = createCanvas(320,240);
		video = createCapture(VIDEO);
		video.size(320,240);
		video.hide();
	}

	function draw(){
		image(video, 0, 0, 320, 240);

		if(frameRate() > 55 && id != null){
			socket.emit('updateUser', {id:id, capture:c.canvas.toDataURL()});
		}
	}
	</script>
</body>	
</html>
